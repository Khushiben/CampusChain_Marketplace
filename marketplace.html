<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marketplace - Decentralized College Marketplace</title>
  <link rel="stylesheet" href="css/style.css" />

  <!-- Ethers.js + QR Code -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <style>
   /* ---------------- Flip Card (Front + Back) ---------------- */

body {
  margin: 0;
  font-family: sans-serif;
  overflow-x: hidden;
}

.bubble-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  overflow: hidden;
  background: linear-gradient(135deg, #ff9a9e, #fad0c4, #a1c4fd, #c2e9fb);
  background-size: 400% 400%;
  animation: gradientShift 20s ease infinite;
}

/* Bubble shapes */
.bubble-bg span {
  position: absolute;
  display: block;
  width: 20px;
  height: 20px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  animation: float 15s linear infinite;
}

/* Different sizes & positions */
.bubble-bg span:nth-child(1) { left: 10%; width: 30px; height: 30px; animation-duration: 20s; }
.bubble-bg span:nth-child(2) { left: 25%; width: 20px; height: 20px; animation-duration: 18s; }
.bubble-bg span:nth-child(3) { left: 40%; width: 25px; height: 25px; animation-duration: 22s; }
.bubble-bg span:nth-child(4) { left: 55%; width: 15px; height: 15px; animation-duration: 17s; }
.bubble-bg span:nth-child(5) { left: 70%; width: 35px; height: 35px; animation-duration: 25s; }
.bubble-bg span:nth-child(6) { left: 85%; width: 20px; height: 20px; animation-duration: 19s; }
.bubble-bg span:nth-child(7) { left: 50%; width: 40px; height: 40px; animation-duration: 30s; }

@keyframes float {
  0% { transform: translateY(100vh) translateX(0) rotate(0deg); }
  50% { transform: translateY(50vh) translateX(20px) rotate(45deg); }
  100% { transform: translateY(-100px) translateX(-20px) rotate(90deg); }
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

main {
  position: relative;
  z-index: 1;
  padding: 80px 20px;
}

.products {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}


.flip-card {
  background-color: transparent;
  perspective: 1000px;
  margin: 20px auto;
}

.flip-card-inner {
  position: relative;
  width: 100%;
  max-width: 280px;
  transition: transform 0.8s ease-in-out;
  transform-style: preserve-3d;
}

.flip-card-inner.flipped {
  transform: rotateY(180deg);
}

.flip-card-front,
.flip-card-back {
  position: absolute;
  width: 100%;
  min-height: 400px;
  backface-visibility: hidden;
  border-radius: 16px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  background: #fff;
  overflow: hidden;
  padding: 80px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.flip-card-front img {
  width: 100%;
  height: 355px;
  object-fit: cover;
  border-radius: 12px;
}

.flip-card-back {
  transform: rotateY(180deg);
  background: #f9f9f9;
}

.qr-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  margin: 20px 0;
}

.qr-item {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.qr-item h4 {
  margin-bottom: 8px;
  font-size: 15px;
  color: #333;
}

.qrcode-box, .upi-qr {
  width: 120px;
  height: 120px;
  border: 2px solid #ddd;
  border-radius: 8px;
  padding: 6px;
  background: #fff;
}

.owner-info {
  margin-top: 12px;
  font-size: 13px;
  color: #555;
  word-wrap: break-word;
  text-align: center;
}

.owner-info strong {
  display: block;
  margin-top: 4px;
  color: #222;
}

.flip-card button {
  margin-top: 20px;
  padding: 10px 14px;
  width: 90%;
  border-radius: 10px;
  border: none;
  background: linear-gradient(90deg, #8e2de2, #4a00e0);
  color: #fff;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
}

.flip-card button:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

@media (min-width: 900px) {
  .flip-card-inner {
    max-width: 280px;
  }
}

@media (max-width: 480px) {
  .qrcode-box, .upi-qr {
    width: 100px;
    height: 100px;
  }
}
  </style>
</head>

<body>

<div class="bubble-bg" aria-hidden="true">
  <span></span>
  <span></span>
  <span></span>
  <span></span>
  <span></span>
  <span></span>
  <span></span>
</div>

  <nav class="navbar">
    <div class="logo">CampusChain</div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="marketplace.html">Marketplace</a></li>
      <li><a href="list-item.html">List Item</a></li>
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><button id="connectWalletBtn">Connect Wallet</button></li>
    </ul>
  </nav>

  <section class="marketplace">
    <marquee behavior="scroll" direction="left" scrollamount="10" class="marquee-text18">
      Marketplace
    </marquee>
    <div id="itemsContainer" class="items-grid"></div>
  </section>

  <footer>
    <p>&copy; 2025 Decentralized College Marketplace | Built for Hackathon</p>
  </footer>

  <script src="js/app.js"></script>

  <script>
    window.addEventListener("pageshow", (event) => {
      if (event.persisted) location.reload();
    });

    document.addEventListener("DOMContentLoaded", async () => {
      const itemsContainer = document.getElementById("itemsContainer");
      const items = getListedItems();

      if (!Array.isArray(items) || items.length === 0) {
        itemsContainer.innerHTML = "<p>No items listed yet. Add some from the 'List Item' page!</p>";
        return;
      }

      itemsContainer.innerHTML = "";

      for (const [index, item] of items.entries()) {
        const card = document.createElement("div");
        card.className = "item-card flip-card";

        card.innerHTML = `
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="${item.img}" alt="${item.name}">
              <h4>${item.name}</h4>
              <p>${item.description}</p>
              <p><strong>Price:</strong> ${item.price} ETH</p>
              <button onclick="buyItem('${item.name}', '${item.price}')">Buy</button>
              <button onclick="flipCard(this)">üîç View QR</button>
            </div>

            <div class="flip-card-back">
              <h4>Payment Options</h4>
              <div class="qr-container">
                <div class="qr-item">
                  <p><strong>MetaMask:</strong></p>
                  <canvas id="qrcode-${index}" class="qrcode-box"></canvas>
                </div>
                <div class="qr-item">
                  <p><strong>UPI:</strong></p>
                  <img src="upi.jpg" alt="UPI QR" class="upi-qr">
                </div>
              </div>
              <p><strong>Owner Wallet:</strong> ${item.owner || "0xUnknown"}</p>
              <p><strong>Owner Name:</strong> ${item.ownerName || "Anonymous"}</p>
              <button onclick="flipCard(this)">‚Ü© Back</button>
            </div>
          </div>
        `;

        itemsContainer.appendChild(card);

        // ‚úÖ Fixed template literal for dynamic element ID
        QRCode.toCanvas(
          document.getElementById(`qrcode-${index}`),
          item.owner || "0xUnknown",
          { width: 130 }
        );
      }
    });

    function flipCard(button) {
      const cardInner = button.closest(".flip-card-inner");
      cardInner.classList.toggle("flipped");
    }
  </script>
</body>
</html>
